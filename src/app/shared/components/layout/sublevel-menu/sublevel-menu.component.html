@if (collapsed && data.items && data.items.length > 0) {
  <ul
    [@submenu]="
      (expanded || isFiltering)
        ? {
            value: 'visible',
            params: {
              transitionParams: '400ms cubic-bezier(0.86, 0, 0.07, 1)',
              height: '*'
            }
          }
        : {
            value: 'hidden',
            params: {
              transitionParams: '400ms cubic-bezier(0.86, 0, 0.07, 1)',
              height: '0'
            }
          }
    "
    class="sublevel-nav"
  >
    @for (item of data.items; track $index) {
      <li class="sublevel-nav-item">

        <!-- 📂 GRUPO CON HIJOS -->
        @if(item.items && item.items.length > 0){
          <a
            class="sublevel-nav-link"
            (click)="handleClick(item)"
            [ngClass]="getActiveClass(item)"
          >
            <i class="sublevel-link-icon"></i>
            @if (collapsed) {
              <span class="sublevel-link-text" @fadeInOut
                    [innerHTML]="item.label | hl:term"></span>
            }
            @if (item.items && collapsed) {
              <mat-icon
                class="menu-collapse-icon"
                [fontIcon]="!item.expanded ? 'chevron_right' : 'expand_more'">
              </mat-icon>
            }
          </a>

          <div>
            <app-sublevel-menu
              [data]="item"
              [collapsed]="collapsed"
              [multiple]="multiple"
              [expanded]="item.expanded || isFiltering"
              [isFiltering]="isFiltering"
              [term]="term" />
          </div>
        }

        <!-- 📄 HOJA (link + favorito) -->
        @if (!item.items || (item.items && item.items.length === 0)) {
          <div class="sublevel-leaf">
            <a
              class="sublevel-nav-link"
              [routerLink]="[item.route]"
              routerLinkActive="active-sublevel"
              [routerLinkActiveOptions]="{ exact: true }"
            >
              @if(collapsed){
                <span class="sublevel-link-text" @fadeInOut
                      [innerHTML]="item.label | hl:term"></span>
              }
            </a>

            <!-- ⭐ Botón de favorito -->
            <button
              type="button"
              class="fav-btn"
              (click)="toggleFavorite(item); $event.stopPropagation();"
            >
              <mat-icon>
                {{ item.favorite ? 'star' : 'star_border' }}
              </mat-icon>
            </button>
          </div>
        }

      </li>
    }
  </ul>
}
