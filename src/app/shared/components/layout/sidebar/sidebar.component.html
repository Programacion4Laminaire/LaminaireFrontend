<div class="sidebar" [ngClass]="collapsed ? 'sidebar-collapsed' : ''">
  <div class="menu-btn" (click)="toggleCollapsed()">
    @if(!collapsed){
      <mat-icon class="text-white" fontIcon="chevron_right"></mat-icon>
    } @if(collapsed) {
      <mat-icon class="text-white" fontIcon="chevron_left"></mat-icon>
    }
  </div>

  <div class="logo-container">
    <div class="head">
      <div class="logo">
        <br />
        <span class="logo-line-1">S I R<sup class="reg">®</sup></span>
        <span class="logo-line-2">Enterprise</span>
      </div>
    </div>

    @if (collapsed) {
      <div class="logo-text" @fadeInOut></div>
    }
  </div>

  <!-- === Buscador del menú === -->
  <div class="sidebar-search">
    <input
      type="search"
      placeholder="Buscar menú…"
      [formControl]="searchCtrl"
      (keydown)="$event.stopPropagation()"
      (click)="$event.stopPropagation()"
    />

    @if (isFiltering) {
      <button class="clear-btn" (click)="clearSearch()" aria-label="Borrar filtro">
        <mat-icon fontIcon="close"></mat-icon>
      </button>
    }
  </div>

  <div class="scrollwrap scrollwrap_delayed">
    <ul class="sidebar-nav" @fadeInOut>
      @for (data of (isFiltering ? filteredNavData : navData); track $index) {
        <li class="sidebar-nav-item">
          @if(data.items && data.items.length > 0){
            <a
              class="sidebar-nav-link"
              (click)="handleClick(data)"
              [ngClass]="getActiveClass(data)"
            >
              <mat-icon class="sidebar-link-icon" [fontIcon]="data.icon"></mat-icon>
              @if (collapsed) {
                <span class="sidebar-link-text" @fadeInOut
                      [innerHTML]="data.label | hl:searchCtrl.value"></span>
              }
              @if (data.items && collapsed) {
                <mat-icon
                  class="menu-collapse-icon"
                  [fontIcon]="!data.expanded ? 'chevron_right' : 'expand_more'">
                </mat-icon>
              }
            </a>
          }
          @if(!data.items || (data.items && data.items.length === 0)){
            <a
              class="sidebar-nav-link"
              [routerLink]="[data.route]"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="shrinkItems(data)"
            >
              <mat-icon class="sidebar-link-icon" [fontIcon]="data.icon"></mat-icon>
              @if (collapsed) {
                <span class="sidebar-link-text" @fadeInOut
                      [innerHTML]="data.label | hl:searchCtrl.value"></span>
              }
            </a>
          }
          @if(collapsed && data.items && data.items.length > 0){
            <div>
              <app-sublevel-menu
                [data]="data"
                [collapsed]="collapsed"
                [multiple]="multiple"
                [expanded]="data.expanded || isFiltering"
                [isFiltering]="isFiltering"
                [term]="searchCtrl.value" />
            </div>
          }
        </li>
      }
    </ul>
  </div>
</div>