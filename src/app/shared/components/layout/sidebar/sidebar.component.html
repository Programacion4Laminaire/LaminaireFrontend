<div class="sidebar" [ngClass]="collapsed ? 'sidebar-collapsed' : ''">
  <div class="menu-btn" (click)="toggleCollapsed()">
    @if(!collapsed){
      <mat-icon class="text-white" fontIcon="chevron_right"></mat-icon>
    } @if(collapsed) {
      <mat-icon class="text-white" fontIcon="chevron_left"></mat-icon>
    }
  </div>

  <div class="logo-container">
    <div class="head">
      <div class="logo">
        <br />
        <span class="logo-line-1">S I R<sup class="reg">®</sup></span>
        <span class="logo-line-2">Enterprise</span>
      </div>
    </div>

    @if (collapsed) {
      <div class="logo-text" @fadeInOut></div>
    }
  </div>

  <!-- 🔎 Buscador -->
  <div class="sidebar-search">
    <input
      type="search"
      placeholder="Buscar menú…"
      [formControl]="searchCtrl"
      (keydown)="$event.stopPropagation()"
      (click)="$event.stopPropagation()"
    />

    @if (isFiltering) {
      <button class="clear-btn" (click)="clearSearch()" aria-label="Borrar filtro">
        <mat-icon fontIcon="close"></mat-icon>
      </button>
    }
  </div>

  <div class="scrollwrap scrollwrap_delayed">

 <!-- ⭐ FAVORITOS ARRIBA -->
@if(getFavorites().length > 0){
  <div class="favorites-section">
    <div class="favorites-title-row">
      <h4 class="favorites-title">Favoritos</h4>
      
    </div>

    <!-- añadimos la clase favorites-list -->
    <ul class="sidebar-nav favorites-list">
      @for(fav of getFavorites(); track fav.menuId){
        <li class="sidebar-nav-item favorite-item">
          <a
            class="sidebar-nav-link"
            [routerLink]="[fav.route]"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
          >
            <mat-icon class="sidebar-link-icon" [fontIcon]="fav.icon"></mat-icon>
            @if (collapsed) {
              <span class="sidebar-link-text" @fadeInOut>
                {{ fav.label }}
              </span>
            }
          </a>

          <button
            type="button"
            class="remove-fav"
            (click)="toggleFavorite(fav); $event.stopPropagation();"
            aria-label="Quitar de favoritos"
          >
            <mat-icon>close</mat-icon>
          </button>
        </li>
      }
    </ul>
  </div>
}


    <!-- 📂 MENÚ NORMAL -->
    <ul class="sidebar-nav" @fadeInOut>
      @for (data of (isFiltering ? filteredNavData : navData); track $index) {
        <li class="sidebar-nav-item">

          <!-- 📁 NODO CON HIJOS -->
          @if(data.items && data.items.length > 0){
            <a
              class="sidebar-nav-link"
              (click)="onRootClick(data, $event)"
              [ngClass]="getActiveClass(data)"
            >
              <mat-icon class="sidebar-link-icon" [fontIcon]="data.icon"></mat-icon>
              @if (collapsed) {
                <span class="sidebar-link-text" @fadeInOut
                      [innerHTML]="data.label | hl:searchCtrl.value"></span>
              }
              @if (data.items && collapsed) {
                <mat-icon
                  class="menu-collapse-icon"
                  [fontIcon]="!data.expanded ? 'chevron_right' : 'expand_more'">
                </mat-icon>
              }
            </a>
          }

          <!-- 🔗 NODO HOJA -->
          @if(!data.items || (data.items && data.items.length === 0)){
            <a
              class="sidebar-nav-link"
              [routerLink]="[data.route]"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="onLeafClick(data, $event)"
              [class.active]="tempActiveRoute === data.route"
            >
              <mat-icon class="sidebar-link-icon" [fontIcon]="data.icon"></mat-icon>
              @if (collapsed) {
                <span class="sidebar-link-text" @fadeInOut
                      [innerHTML]="data.label | hl:searchCtrl.value"></span>
              }
            </a>
          }

          <!-- 📂 SUBNIVELES -->
          @if(collapsed && data.items && data.items.length > 0){
            <div>
              <app-sublevel-menu
                [data]="data"
                [collapsed]="collapsed"
                [multiple]="multiple"
                [expanded]="data.expanded || isFiltering"
                [isFiltering]="isFiltering"
                [term]="searchCtrl.value" />
            </div>
          }
        </li>
      }
    </ul>
  </div>
</div>
