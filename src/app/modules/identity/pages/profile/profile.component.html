<div class="h-screen flex flex-col px-6 py-8 gap-6 overflow">
  <!-- Header -->
  <div class="bg-white rounded-2xl shadow-xl p-6 flex items-center">
    <mat-icon class="text-xl text-am-main-blue-dark mb-1">person</mat-icon>
    <div class="ml-2 text-xl font-semibold italic text-am-main-blue-dark">
      Mi Perfil
    </div>
  </div>

  <!-- Contenido -->
  <div class="bg-white rounded-2xl shadow-xl p-6">
    <form *ngIf="form" [formGroup]="form">
      
      <!-- Panel izquierdo (Avatar + resumen) -->
     <div class="profile-left w-full md:w-72 shrink-0 md:pl-6">
  <div class="image-container mx-auto md:ml-8">
          <img
            [src]="imagePreview"
            (error)="setDefaultImage($event)"
            alt="Foto de perfil"
          />

          <input
            type="file"
            hidden
            #fileInput
            (change)="onFileSelected($event)"
            accept="image/*"
          />

          <!-- Botón de cambiar foto -->
          <button
            type="button"
            class="avatar-btn"
            (click)="fileInput.click()"
            aria-label="Cambiar foto"
          disabled>
            <mat-icon>add_a_photo</mat-icon>
          </button>
        </div>

        <!-- Resumen -->
        <div class="profile-summary mt-4">
          <div class="name">
            {{ form.get('firstName')?.value }}
            {{ form.get('lastName')?.value }}
          </div>
          <div
            class="email truncate"
            [title]="form.get('email')?.value"
          >
            {{ form.get('email')?.value }}
          </div>
        </div>

        <!-- Tips -->
        <div class="profile-tips">
          Sube una imagen (JPG/PNG) para mejores resultados.
        </div>
      </div>

      <!-- Panel derecho (Formulario) -->
      <div class="form-panel">
        <!-- Sección: Datos personales -->
        <h3 class="section-title">Datos personales</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <mat-form-field appearance="outline">
            <mat-label>Nombres</mat-label>
            <input matInput formControlName="firstName" readonly="readonly" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Apellidos</mat-label>
            <input matInput formControlName="lastName" readonly="readonly" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Identificación</mat-label>
            <input matInput formControlName="identification" readonly="readonly"/>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Fecha de nacimiento</mat-label>
            <input matInput type="date" formControlName="birthDate" readonly="readonly"/>
          </mat-form-field>
        </div>

        <!-- Sección: Cuenta -->
        <h3 class="section-title mt-6">Cuenta</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <mat-form-field appearance="outline">
            <mat-label>Usuario</mat-label>
            <input matInput formControlName="userName" readonly="readonly" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email" readonly="readonly"/>
          </mat-form-field>

     <mat-form-field appearance="outline">
  <mat-label>Nueva Contraseña</mat-label>
  <input
    matInput
    [type]="hidePassword ? 'password' : 'text'"
    formControlName="password"
    placeholder="Dejar en blanco si no desea cambiarla"
    autocomplete="new-password"
  />
  <button
    mat-icon-button
    matSuffix
    type="button"
    (click)="hidePassword = !hidePassword"
    [attr.aria-label]="'Mostrar u ocultar contraseña'"
    [attr.aria-pressed]="!hidePassword"
  >
    <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
  </button>
</mat-form-field>

<mat-form-field appearance="outline">
  <mat-label>Confirmar contraseña</mat-label>
  <input
    matInput
    [type]="hideConfirmPassword ? 'password' : 'text'"
    formControlName="confirmPassword"
    placeholder="Repite la contraseña"
    autocomplete="new-password"
 />
  <button
    mat-icon-button
    matSuffix
    type="button"
    (click)="hideConfirmPassword = !hideConfirmPassword"
    [attr.aria-label]="'Mostrar u ocultar contraseña'"
    [attr.aria-pressed]="!hideConfirmPassword"
  >
    <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
  </button>
  <mat-error *ngIf="form.hasError('passwordMismatch')">
    Las contraseñas no coinciden
  </mat-error>
</mat-form-field>

        </div>

        <!-- Botones -->
        <div class="flex justify-end gap-3 mt-6">
          <button
            mat-raised-button
            color="primary"
            type="button"
            (click)="save()"
            [disabled]="loading || form.hasError('passwordMismatch')"
          >
            <mat-icon>save</mat-icon>
            Guardar
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
